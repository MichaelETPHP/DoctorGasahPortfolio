{"version":3,"file":"_server-BWscrYHo.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/booking/_server.js"],"sourcesContent":["import { j as json } from \"../../../../chunks/index.js\";\nimport sgMail from \"@sendgrid/mail\";\nsgMail.setApiKey(process.env.SENDGRID_API_KEY);\nasync function sendEmail(options) {\n  try {\n    const msg = {\n      to: options.to,\n      from: \"michaeltaye012@gmail.com\",\n      // Use your verified sender\n      subject: options.subject,\n      text: options.text,\n      html: options.html || options.text\n      // Fall back to text if HTML not provided\n    };\n    await sgMail.send(msg);\n    console.log(\"Email sent successfully\");\n    return true;\n  } catch (error) {\n    console.error(\"SendGrid email error:\", error);\n    return false;\n  }\n}\nasync function sendBookingConfirmation(booking) {\n  const subject = `Appointment Request: ${booking.patientName} for ${booking.service}`;\n  const htmlContent = `\n    <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; color: #333;\">\n      <div style=\"text-align: center; margin-bottom: 20px;\">\n        <div style=\"display: inline-block; background-color: #f87171; width: 40px; height: 40px; border-radius: 50%; margin-bottom: 10px;\">\n          <!-- Heart logo representation -->\n        </div>\n        <h1 style=\"margin: 0; font-size: 24px; color: #1e40af;\">Dr. Gasah A</h1>\n        <p style=\"margin: 5px 0 0; color: #6b7280;\">Pediatric Hematology Oncologist</p>\n      </div>\n    \n      <div style=\"background-color: #1e40af; color: white; padding: 15px; text-align: center; border-radius: 5px 5px 0 0; position: relative;\">\n        <h2 style=\"margin: 0; font-size: 20px;\">New Appointment Request</h2>\n        <div style=\"position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 50px; height: 3px; background-color: #f87171;\"></div>\n      </div>\n      \n      <div style=\"background-color: #f9fafb; padding: 20px; border-radius: 0 0 5px 5px; border: 1px solid #e5e7eb;\">\n        <div style=\"background-color: #ebf5ff; border: 1px solid #dbeafe; border-radius: 5px; padding: 15px; margin-bottom: 20px;\">\n          <div style=\"display: flex; align-items: center; margin-bottom: 10px;\">\n            <div style=\"width: 30px; height: 30px; background-color: #dbeafe; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;\">\n              <span style=\"color: #2563eb; font-weight: bold;\">i</span>\n            </div>\n            <p style=\"margin: 0; font-weight: bold; color: #1e40af;\">Appointment Details</p>\n          </div>\n          <p style=\"margin: 0; color: #4b5563;\">The following patient has requested an appointment with Dr. Gasah.</p>\n        </div>\n\n        <table style=\"width: 100%; border-collapse: collapse;\">\n          <tr style=\"border-bottom: 1px solid #e5e7eb;\">\n            <td style=\"padding: 10px 0; font-weight: bold; width: 40%;\">Patient Name:</td>\n            <td style=\"padding: 10px 0;\">${booking.patientName}</td>\n          </tr>\n          <tr style=\"border-bottom: 1px solid #e5e7eb;\">\n            <td style=\"padding: 10px 0; font-weight: bold;\">Email:</td>\n            <td style=\"padding: 10px 0;\">${booking.email}</td>\n          </tr>\n          <tr style=\"border-bottom: 1px solid #e5e7eb;\">\n            <td style=\"padding: 10px 0; font-weight: bold;\">Phone:</td>\n            <td style=\"padding: 10px 0;\">${booking.phone}</td>\n          </tr>\n          <tr style=\"border-bottom: 1px solid #e5e7eb;\">\n            <td style=\"padding: 10px 0; font-weight: bold;\">Service Requested:</td>\n            <td style=\"padding: 10px 0;\">${booking.service}</td>\n          </tr>\n          <tr style=\"border-bottom: 1px solid #e5e7eb;\">\n            <td style=\"padding: 10px 0; font-weight: bold;\">Preferred Date:</td>\n            <td style=\"padding: 10px 0;\">${booking.date}</td>\n          </tr>\n          <tr style=\"border-bottom: 1px solid #e5e7eb;\">\n            <td style=\"padding: 10px 0; font-weight: bold;\">Preferred Time:</td>\n            <td style=\"padding: 10px 0;\">${booking.time}</td>\n          </tr>\n          ${booking.message ? `\n          <tr>\n            <td style=\"padding: 10px 0; font-weight: bold;\">Additional Message:</td>\n            <td style=\"padding: 10px 0;\">${booking.message}</td>\n          </tr>` : \"\"}\n        </table>\n        \n        <div style=\"background-color: #e0f2fe; padding: 15px; border-radius: 5px; margin-top: 20px; border-left: 4px solid #3b82f6;\">\n          <p style=\"margin: 0; font-weight: bold;\">Action Required:</p>\n          <p style=\"margin: 5px 0 0;\">Please contact the patient to confirm this appointment request.</p>\n        </div>\n      </div>\n      \n      <div style=\"text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px;\">\n        <p style=\"margin: 0;\">Dr. Gasah A | Pediatric Hematology Oncologist</p>\n        <p style=\"margin: 5px 0 0;\">Black Lion Hospital & Betzata Private Clinic, Ethiopia</p>\n      </div>\n    </div>\n  `;\n  const textContent = `\n    DR. GASAH A - PEDIATRIC HEMATOLOGY ONCOLOGIST\n    =============================================\n    \n    NEW APPOINTMENT REQUEST\n    \n    APPOINTMENT DETAILS:\n    -------------------\n    Patient Name: ${booking.patientName}\n    Email: ${booking.email}\n    Phone: ${booking.phone}\n    Service Requested: ${booking.service}\n    Preferred Date: ${booking.date}\n    Preferred Time: ${booking.time}\n    ${booking.message ? `\nAdditional Message: ${booking.message}` : \"\"}\n    \n    ACTION REQUIRED:\n    --------------\n    Please contact the patient to confirm this appointment request.\n    \n    --\n    Dr. Gasah A | Pediatric Hematology Oncologist\n    Black Lion Hospital & Betzata Private Clinic, Ethiopia\n  `;\n  return sendEmail({\n    to: \"michaeltaye012@gmail.com\",\n    // Replace with your actual email\n    subject,\n    text: textContent,\n    html: htmlContent\n  });\n}\nasync function POST({ request }) {\n  try {\n    const booking = await request.json();\n    const requiredFields = [\"patientName\", \"email\", \"phone\", \"service\", \"date\", \"time\"];\n    const missingFields = requiredFields.filter((field) => !booking[field]);\n    if (missingFields.length > 0) {\n      return json({\n        success: false,\n        message: `Missing required fields: ${missingFields.join(\", \")}`\n      }, { status: 400 });\n    }\n    const emailSent = await sendBookingConfirmation(booking);\n    if (!emailSent) {\n      return json({\n        success: false,\n        message: \"Failed to send email notification. Please try again later.\"\n      }, { status: 500 });\n    }\n    return json({\n      success: true,\n      message: \"Booking request received. We will contact you to confirm your appointment.\"\n    });\n  } catch (error) {\n    console.error(\"Booking error:\", error);\n    return json({\n      success: false,\n      message: \"An error occurred while processing your request. Please try again later.\"\n    }, { status: 500 });\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}